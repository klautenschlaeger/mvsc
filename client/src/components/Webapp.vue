<template>
  <div class="container">
    <div class="row">
      <div class="col-sm-10">
        <h1>Multi-Vehicle-ASC-Controller</h1>
        <hr><br><br>
        <alert :message=message v-if="showMessage"></alert>
        <b-button  v-b-modal.machine-modal>Add Machine</b-button>
        <b-button id="show-btn" @click="$bvModal.show('bv-modal-example')">Open all Machines</b-button>


        <br><br>
      </div>
    </div>
    <div class="map" id="map" ref="mapElement">
      <l-map style="height: 350px" :zoom="zoom" :center="center">
        <l-tile-layer :url="url"></l-tile-layer>
        <l-polygon :lat-lngs="polygon1.latlngs" :color="polygon1.color"></l-polygon>
        <l-polygon :lat-lngs="polygon2.latlngs" :color="polygon2.color"></l-polygon>
        <l-polygon :lat-lngs="polygon3.latlngs" :color="polygon3.color"></l-polygon>
      </l-map>
    </div>
    <b-modal id="bv-modal-example" size="xl" hide-footer>
      <template #modal-title>
        All Machines
      </template>
      <table class="table table-hover">
        <thead>
          <tr>
            <th scope="col">Name</th>
            <th scope="col">Vorname</th>
            <th scope="col">Maschine</th>
            <th scope="col">Gruppe 1 Spritzen</th>
            <th scope="col">Gruppe 2 Sähen</th>
            <th scope="col">Gruppe 3 Düngen</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          <tr v-for="(machine, index) in machines" :key="index">
            <td>{{ machine.drivername }}</td>
            <td>{{ machine.forename }}</td>
            <td>{{ machine.machineid }}</td>
            <td>
              <span v-if="machine.one">X</span>
              <span v-else></span>
            </td>
            <td>
              <span v-if="machine.two">X</span>
              <span v-else></span>
            </td>
            <td>
              <span v-if="machine.three">X</span>
              <span v-else></span>
            </td>
            <td>
              <div class="btn-group" role="group">
                <button
                        type="button"
                        class="btn btn-warning btn-sm"
                        v-b-modal.machine-update-modal
                        @click="editBook(book)">
                    Update
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
      <b-button class="mt-3" block @click="$bvModal.hide('bv-modal-example')">Close Me</b-button>
    </b-modal>
    <b-modal ref="addMachineModal"
            id="machine-modal"
            title="Add a new machine"
            hide-footer>
      <b-form @submit="onSubmit" class="w-100">
      <b-form-group id="form-drivername-group"
                    label="Name:"
                    label-for="form-drivername-input">
          <b-form-input id="form-drivername-input"
                        type="text"
                        v-model="addMachineForm.drivername"
                        required
                        placeholder="Enter Name">
          </b-form-input>
        </b-form-group>
        <b-form-group id="form-forename-group"
                      label="Vorname:"
                      label-for="form-forename-input">
            <b-form-input id="form-forename-input"
                          type="text"
                          v-model="addMachineForm.forename"
                          required
                          placeholder="Enter Vorname">
            </b-form-input>
          </b-form-group>
        <b-form-group id="form-machineid-group"
                      label="Maschine:"
                      label-for="form-machineid-input">
            <b-form-input id="form-machineid-input"
                          type="text"
                          v-model="addMachineForm.machineid"
                          required
                          placeholder="Enter Maschine">
            </b-form-input>
          </b-form-group>
        <b-form-group id="form-read-group">
          <b-form-checkbox-group v-model="addMachineForm.one" id="form-checks-one">
            <b-form-checkbox value="true">Gruppe1</b-form-checkbox>
          </b-form-checkbox-group>
          <b-form-checkbox-group v-model="addMachineForm.two" id="form-checks-two">
            <b-form-checkbox value="true">Gruppe 2</b-form-checkbox>
          </b-form-checkbox-group>
          <b-form-checkbox-group v-model="addMachineForm.three" id="form-checks-three">
            <b-form-checkbox value="true">Gruppe 3</b-form-checkbox>
          </b-form-checkbox-group>
        </b-form-group>
        <b-button-group>
          <b-button type="submit" variant="primary">Submit</b-button>
        </b-button-group>
      </b-form>
    </b-modal>
  </div>
</template>
<style>
.map {
  height: 100%;
  width: 100%;
}
</style>
<script>
import axios from 'axios';
import { LMap, LTileLayer, LPolygon } from 'vue2-leaflet';
import Alert from './Alert.vue';

export default {
  data() {
    return {
      url: 'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
      zoom: 15,
      center: [51.7283462477326, 12.116302453006],
      polygon1: {
        latlngs: [[[51.7224746716369, 12.1197675039469], [51.7224697912661, 12.1197262169284], [51.7224785273995, 12.1197228450829], [51.7224831561121, 12.1197627573145], [51.7224746716369, 12.1197675039469]], [[51.7228251082088, 12.1200182412467], [51.7228016321036, 12.1197898162725], [51.722805326085, 12.1197886151021], [51.7227939834951, 12.1196743013114], [51.7227986122065, 12.1196731290849], [51.7227814904682, 12.1195016656349], [51.7229502182336, 12.1194580906477], [51.7230364201193, 12.1194382641009], [51.7231309986244, 12.1194122435672], [51.72327346407, 12.1193774675147], [51.7233675662223, 12.1193509549353], [51.7234276945316, 12.1193395655249], [51.7234860971855, 12.1193239213664], [51.7236644059342, 12.1192817067408], [51.7238415912092, 12.1192328639704], [51.723882350833, 12.1192251793745], [51.7239402232072, 12.1192113152637], [51.7240787250379, 12.1191749762425], [51.7241252188711, 12.119690567763], [51.7239943386856, 12.1197249675453], [51.7239307321019, 12.1197403222651], [51.723878045682, 12.1197507420561], [51.7237183236812, 12.1197954169101], [51.7235326359576, 12.119839483943], [51.7234797607941, 12.1198537677399], [51.7234057193872, 12.1198682975596], [51.7233293231795, 12.1198906132787], [51.7231990451759, 12.1199223646974], [51.7230871741645, 12.1199527557546], [51.7229950942648, 12.1199740294946], [51.7228251082088, 12.1200182412467]], [[51.7241252188711, 12.119690567763], [51.7240787250379, 12.1191749762425], [51.7241106653667, 12.1191665973059], [51.7241107103057, 12.1191671327831], [51.7241826755169, 12.1191495199243], [51.7243763623287, 12.1190995468746], [51.7244435550249, 12.1190792132126], [51.7246288831947, 12.1190373157383], [51.724732970757, 12.1190105274049], [51.7247932338694, 12.1189929434908], [51.7248912996144, 12.1189685865135], [51.7249574766907, 12.1189490198865], [51.7249758207642, 12.1189425652151], [51.7249774475536, 12.1189567915424], [51.7250264220055, 12.1189432164712], [51.7250553267288, 12.118937861699], [51.7250542571821, 12.1189234906482], [51.725121845341, 12.1189105378885], [51.725197279838, 12.118889495081], [51.7253127729022, 12.1188634014208], [51.7253960986762, 12.1188393194183], [51.7254118362914, 12.1188353105753], [51.7254560562039, 12.1193514961425], [51.725446511174, 12.1193539564432], [51.7254056706695, 12.1193665763388], [51.7253679848782, 12.1193767648783], [51.7252429647598, 12.1194052609498], [51.7251780819248, 12.1194236118988], [51.7251544170814, 12.1194290390328], [51.7250628764699, 12.1194463334998], [51.7249495584503, 12.1194810816296], [51.7248230823104, 12.119512978705], [51.7247929911992, 12.1195224870438], [51.7246802573857, 12.1195517067331], [51.7244887276428, 12.1195951093326], [51.7244795151611, 12.1195989300349], [51.7244347200302, 12.1196119985736], [51.7242360899356, 12.1196633609696], [51.7241252188711, 12.119690567763]], [[51.7254560562039, 12.1193514961425], [51.7254118362914, 12.1188353105753], [51.7254437955832, 12.1188271703487], [51.7254438225466, 12.1188275321683], [51.7254845551884, 12.1188176472575], [51.7255551812032, 12.1188049546267], [51.7256040477905, 12.1187912778467], [51.7257295532207, 12.1187593798328], [51.7258409927674, 12.1187283791315], [51.7258976877155, 12.1187148181337], [51.7259431479322, 12.118705729226], [51.7259855972409, 12.1186935431426], [51.7261275233544, 12.1186574335488], [51.7262130601047, 12.1186369835064], [51.7262770890853, 12.1186185307079], [51.7263845919821, 12.1185939559223], [51.7264954563106, 12.1185643590809], [51.7265453834564, 12.118554141296], [51.7266354320747, 12.1185271640284], [51.726659546302, 12.1185209262589], [51.7266654962157, 12.1185196960723], [51.726666862359, 12.118533995182], [51.7266884510187, 12.1185282205415], [51.726743294483, 12.1185164975872], [51.7267931137755, 12.1190161559501], [51.7267249953526, 12.119031511573], [51.7266840020651, 12.1190422793236], [51.7266674645406, 12.119048256583], [51.7266007841634, 12.1190674764389], [51.7265396222862, 12.1190805019437], [51.7264383119733, 12.1191077541942], [51.7263250479062, 12.1191337183671], [51.7262943815837, 12.1191434440773], [51.7262679754712, 12.1191504344315], [51.7261727678643, 12.1191733303743], [51.7260352547532, 12.1192083834549], [51.7259979913965, 12.1192192090967], [51.7259404066577, 12.1192312070339], [51.7258855631934, 12.1192444206848], [51.7257864638756, 12.1192722663194], [51.7256532828769, 12.1193062049958], [51.7256100696064, 12.1193184055519], [51.7255213332048, 12.1193352808169], [51.7254560562039, 12.1193514961425]], [[51.7267931137755, 12.1190161559501], [51.726743294483, 12.1185164975872], [51.726751098113, 12.1185148275352], [51.7267497409578, 12.118500528005], [51.7268114780391, 12.1184849114129], [51.7268737094486, 12.1184675435624], [51.7269593270693, 12.1184495099444], [51.7270632438162, 12.1184213595535], [51.7271716095157, 12.1183949604209], [51.7272810088102, 12.118366462673], [51.7273474644776, 12.118351207911], [51.72745885906, 12.1183217549313], [51.7275039327917, 12.1183117394709], [51.727582899453, 12.1182913901395], [51.7277444548522, 12.1182534269131], [51.7279302862533, 12.1182021483347], [51.7279720704564, 12.118193565722], [51.7280750165227, 12.1181669494912], [51.7281256806555, 12.1186815588993], [51.7280217099818, 12.1187084356478], [51.7279721064075, 12.1187188129385], [51.7279259451541, 12.1187324901207], [51.7277976715153, 12.1187673705536], [51.7276298965703, 12.1188068968866], [51.7275547047778, 12.1188263199326], [51.7275021442229, 12.1188381011245], [51.7273793621195, 12.1188704921655], [51.7273256691039, 12.1188824904555], [51.7272245565453, 12.1189089619542], [51.7271101420678, 12.1189368807738], [51.727012723488, 12.1189633812189], [51.7269161227965, 12.1189840779073], [51.7268370752451, 12.1190061495506], [51.7268251574449, 12.1190088560406], [51.7268251664326, 12.1190089284066], [51.7267931137755, 12.1190161559501]]],
        color: 'yellow',
      },
      polygon2: {
        latlngs: [[[51.7230125304577, 12.1220804531327], [51.7230094296705, 12.1220519433113], [51.7230114429352, 12.1220514512636], [51.7229877780872, 12.1218377433788], [51.7229914990317, 12.1218367158675], [51.722985144665, 12.1217797541126], [51.7229897823641, 12.1217781766656], [51.7229760040838, 12.1216498679972], [51.7229810282577, 12.1216484207981], [51.7229718966643, 12.1215628479179], [51.7230323395443, 12.1215463064327], [51.7230960899307, 12.1215325146256], [51.7231832355314, 12.1215080714336], [51.7232436244847, 12.1214937152189], [51.7234238206635, 12.1214463773378], [51.7237550835974, 12.1213668248056], [51.7238458153259, 12.1213412817422], [51.7239894491796, 12.1213086908195], [51.7240155227551, 12.121301686376], [51.7240553566353, 12.1212885747526], [51.7240852050821, 12.121280209942], [51.7241726382921, 12.1212610779705], [51.7242635407885, 12.1212353467712], [51.7243071675157, 12.1217516495069], [51.724265437212, 12.1217642256667], [51.7242110071627, 12.1217786831853], [51.7241309888785, 12.12179594827], [51.7240793540315, 12.1218124463393], [51.7240457217256, 12.1218217518292], [51.723890080186, 12.12185738187], [51.7238105562302, 12.1218801028952], [51.7234717255781, 12.1219616091461], [51.7232972546208, 12.1220074998282], [51.7232299630457, 12.1220235926817], [51.7231502862975, 12.122046140043], [51.7230752652239, 12.1220626815283], [51.7230125304577, 12.1220804531327]], [[51.7243071675157, 12.1217516495069], [51.7242635407885, 12.1212353467712], [51.72426419188, 12.1212351743908], [51.7242955862193, 12.1212280973793], [51.7242956041949, 12.1212283868276], [51.7243081421575, 12.1212256804858], [51.7244382044204, 12.1211930307149], [51.7244951510376, 12.1211802081542], [51.7245399551548, 12.1211684276074], [51.7245806518535, 12.1211549682604], [51.7246318642627, 12.1211417259996], [51.7246808297252, 12.1211313348048], [51.7247591582872, 12.1211094090942], [51.7248363184369, 12.1210932578778], [51.7248691418343, 12.1210850086006], [51.7249054614808, 12.1210740674539], [51.7249581299115, 12.1210627066072], [51.7250978091063, 12.1210268294875], [51.7251647950813, 12.1210112426953], [51.7252404362951, 12.1209910826196], [51.72536594175, 12.1209615878354], [51.7255942764738, 12.1209036258086], [51.7256426936813, 12.1214187714625], [51.7254169564279, 12.1214760822305], [51.725286813275, 12.1215067058632], [51.7252200250312, 12.121524608242], [51.7251436198556, 12.1215425829829], [51.7250095310643, 12.1215770996955], [51.7249491511125, 12.1215902840666], [51.7249459874115, 12.1215921510083], [51.724925944647, 12.1215979255023], [51.7248871893102, 12.1216077812178], [51.7247999448637, 12.1216262480208], [51.7247309905634, 12.1216459305068], [51.7246734237889, 12.1216584057295], [51.7246317024825, 12.1216694337107], [51.7246033190518, 12.1216793473158], [51.7245473880545, 12.1216943696838], [51.7244815974551, 12.1217093196897], [51.7243565503772, 12.1217408116673], [51.7243071675157, 12.1217516495069]], [[51.7256426936813, 12.1214187714625], [51.7255942764738, 12.1209036258086], [51.7256262440436, 12.1208955279559], [51.7256262530314, 12.1208956292658], [51.7258225192871, 12.1208465952782], [51.726144713395, 12.1207612778765], [51.7263138814797, 12.1207214196705], [51.7264563198925, 12.120684267886], [51.7265086737387, 12.1206722264817], [51.72684943661, 12.1205872564282], [51.7269019522363, 12.1205754465894], [51.7269260125361, 12.1205693390502], [51.7269760655094, 12.1210840946101], [51.7269529219637, 12.1210899705838], [51.7268940519735, 12.121103300071], [51.7265597872706, 12.1211867070575], [51.7265018430223, 12.1212001089089], [51.7263652466696, 12.1212358278822], [51.7261894545876, 12.1212772925736], [51.7258747113532, 12.1213607863972], [51.7256426936813, 12.1214187714625]], [[51.7269760655094, 12.1210840946101], [51.7269260125361, 12.1205693390502], [51.7269579715765, 12.1205612306775], [51.7269579805642, 12.1205613464636], [51.7271969207674, 12.1205017455467], [51.7275524145367, 12.1204099850288], [51.727675079795, 12.1203806187684], [51.7278773768081, 12.120330121537], [51.7279489285462, 12.12031104577], [51.728008247912, 12.1202931278644], [51.7280654371734, 12.1202787703827], [51.728101190573, 12.1202685233091], [51.7281896842815, 12.1202499685798], [51.7282624134191, 12.1202314717435], [51.7283083679521, 12.1207472411155], [51.7282399439623, 12.1207646958765], [51.728144206101, 12.1207849295049], [51.7281209007804, 12.1207920937725], [51.7280584267029, 12.1208078551611], [51.7280033765338, 12.120824600732], [51.7279311686876, 12.1208439080713], [51.727726202303, 12.1208951144928], [51.7275993397502, 12.1209255083552], [51.7272492476383, 12.1210159228593], [51.7269760655094, 12.1210840946101]]],
        color: 'red',
      },
      polygon3: {
        latlngs: [],
        color: 'blue',
      },
      polling: null,
      machines: [],
      addMachineForm: {
        drivername: '',
        forename: '',
        machineid: '',
        one: [],
        two: [],
        three: [],
      },
      message: '',
      showMessage: false,
    };
  },
  components: {
    alert: Alert,
    LMap,
    LTileLayer,
    LPolygon,
  },
  methods: {
    getMachines() {
      const path = 'http://localhost:5000/mv';
      axios.get(path)
        .then((res) => {
          this.machines = res.data.machines;
        })
        .catch((error) => {
          // eslint-disable-next-line
          console.error(error);
        });
    },
    addMachine(payload) {
      const path = 'http://localhost:5000/mv';
      axios.post(path, payload)
        .then(() => {
          this.getMachines();
          this.message = 'Machine added!';
          this.showMessage = true;
        })
        .catch((error) => {
          // eslint-disable-next-line
          console.log(error);
          this.getMachines();
        });
    },
    initForm() {
      this.addMachineForm.drivername = '';
      this.addMachineForm.forename = '';
      this.addMachineForm.machineid = '';
      this.addMachineForm.one = [];
      this.addMachineForm.two = [];
      this.addMachineForm.three = [];
    },
    onSubmit(evt) {
      evt.preventDefault();
      this.$refs.addMachineModal.hide();
      let one = false;
      if (this.addMachineForm.one[0]) one = true;
      let two = false;
      if (this.addMachineForm.two[0]) two = true;
      let three = false;
      if (this.addMachineForm.three[0]) three = true;
      const payload = {
        drivername: this.addMachineForm.drivername,
        forename: this.addMachineForm.forename,
        machineid: this.addMachineForm.machineid,
        one, // property shorthand
        two,
        three,
      };
      this.addMachine(payload);
      this.initForm();
    },
  },
  created() {
    this.getMachines();
    // this.pollData();
  },
  beforeDestroy() {
    // clearInterval(this.polling);
  },

};
</script>
